import{r as n,j as e,A as q,R as K,a as F}from"./chunk-App-fHdxGh8o.js";async function N(i,c){const l=await fetch(i,{credentials:"include",...c,headers:{...c?.headers??{}}}),d=await l.text();if(!l.ok)throw new Error(`${c?.method??"GET"} ${i} failed: ${l.status} ${d}`);if(!d)return{};try{return JSON.parse(d)}catch{throw new Error(`Invalid JSON from ${c?.method??"GET"} ${i}: ${d.slice(0,200)}`)}}async function H(){return N("/Admin/GetUsers")}async function Q(i){const c=encodeURIComponent(i);return N(`/Admin/GetAssignments?userId=${c}`)}async function V(i,c,l){return N("/Admin/AssignDevices",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:i,deviceGuid:c,deviceName:l})})}async function W(i,c){return N("/Admin/UnassignDevice",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:i,deviceGuid:c})})}function v(i){if(i instanceof Error)return i.message;if(typeof i=="string")return i;try{return JSON.stringify(i)}catch{return"Unknown error"}}function X(){const[i,c]=n.useState(!0),[l,d]=n.useState([]),[a,D]=n.useState(""),[m,f]=n.useState(""),[S,b]=n.useState(""),[u,p]=n.useState([]),[C,G]=n.useState(!1),[o,A]=n.useState(!1),[h,x]=n.useState(!1),[T,L]=n.useState(""),[U,R]=n.useState(""),[y,O]=n.useState("");n.useEffect(()=>{const s=()=>c(!0),t=()=>c(!1),k=()=>c(P=>!P);return window.addEventListener("elitech:assign:open",s),window.addEventListener("elitech:assign:close",t),window.addEventListener("elitech:assign:toggle",k),()=>{window.removeEventListener("elitech:assign:open",s),window.removeEventListener("elitech:assign:close",t),window.removeEventListener("elitech:assign:toggle",k)}},[]);function r(s,t){R(s),L(t)}n.useEffect(()=>{(async()=>{try{G(!0);const s=await H();d(s.data??[])}catch(s){r("err",`âŒ ${v(s)}`)}finally{G(!1)}})()},[]);async function j(s){if(!s){p([]);return}try{A(!0);const t=await Q(s);if(t.code!==0){p([]),r("err",t.message?`âŒ ${t.message}`:"âŒ Lá»—i táº£i danh sÃ¡ch thiáº¿t bá»‹");return}p(t.data??[])}finally{A(!1)}}n.useEffect(()=>{j(a).catch(s=>r("err",`âŒ ${v(s)}`))},[a]);const M=n.useMemo(()=>{const s=y.trim().toLowerCase();return s?l.filter(t=>t.username.toLowerCase().includes(s)||t.userId.toLowerCase().includes(s)):l},[l,y]),E=n.useMemo(()=>!!a&&!!m.trim(),[a,m]),g=n.useMemo(()=>l.find(s=>s.userId===a),[l,a]),I=n.useMemo(()=>[...u].sort((s,t)=>(s.deviceName??"").localeCompare(t.deviceName??"")||s.deviceGuid.localeCompare(t.deviceGuid)),[u]);async function J(){try{if(!E||h)return;r("",""),x(!0),await V(a,m.trim(),S.trim()||void 0),r("ok","âœ… ÄÃ£ gÃ¡n thiáº¿t bá»‹"),f(""),b(""),await j(a)}catch(s){r("err",`âŒ ${v(s)}`)}finally{x(!1)}}async function B(s){try{if(!a||h||!window.confirm(`Gá»¡ thiáº¿t bá»‹ ${s} khá»i user nÃ y?`))return;r("",""),x(!0),await W(a,s),r("warn","ğŸ—‘ï¸ ÄÃ£ gá»¡ thiáº¿t bá»‹"),await j(a)}catch(t){r("err",`âŒ ${v(t)}`)}finally{x(!1)}}async function $(s){try{await navigator.clipboard.writeText(s),r("ok","ğŸ“‹ ÄÃ£ copy"),window.setTimeout(()=>r("",""),900)}catch{}}return i?e.jsxs("div",{className:"asgn-card",children:[e.jsxs("div",{className:"asgn-head",children:[e.jsxs("div",{className:"asgn-title",children:[e.jsx("div",{className:"asgn-icon",children:"ğŸ”§"}),e.jsxs("div",{children:[e.jsx("div",{className:"asgn-h1",children:"GÃ¡n / Gá»¡ thiáº¿t bá»‹ cho User"}),e.jsx("div",{className:"asgn-sub",children:g?e.jsxs(e.Fragment,{children:["Äang chá»n: ",e.jsx("b",{children:g.username})," ",e.jsx("span",{className:"asgn-dot",children:"â€¢"})," ",e.jsx("span",{className:"asgn-mono",children:g.userId})]}):"Chá»n user Ä‘á»ƒ xem danh sÃ¡ch thiáº¿t bá»‹ Ä‘Ã£ gÃ¡n"})]})]}),e.jsxs("div",{className:"asgn-headActions",children:[e.jsx("button",{className:"asgn-btn ghost",onClick:()=>j(a),disabled:!a||o,children:o?"Äang táº£i...":"â†» Táº£i láº¡i"}),e.jsx("button",{className:"asgn-btn",onClick:()=>c(!1),children:"ÄÃ³ng"})]})]}),T&&e.jsx("div",{className:`asgn-banner ${U?`is-${U}`:""}`,children:e.jsx("span",{children:T})}),e.jsxs("div",{className:"asgn-grid",children:[e.jsxs("div",{className:"asgn-box",children:[e.jsxs("div",{className:"asgn-boxHead",children:[e.jsx("div",{className:"asgn-boxTitle",children:"Chá»n User"}),e.jsx("div",{className:"asgn-pill",children:C?"Loading...":`${l.length} users`})]}),e.jsxs("div",{className:"asgn-field",children:[e.jsx("label",{className:"asgn-label",children:"TÃ¬m nhanh"}),e.jsx("input",{value:y,onChange:s=>O(s.target.value),placeholder:"gÃµ username...",className:"asgn-input"})]}),e.jsxs("div",{className:"asgn-field",children:[e.jsx("label",{className:"asgn-label",children:"Danh sÃ¡ch"}),e.jsxs("select",{value:a,onChange:s=>D(s.target.value),className:"asgn-select",disabled:C,children:[e.jsx("option",{value:"",children:"-- chá»n user --"}),M.map(s=>e.jsx("option",{value:s.userId,children:s.username},s.userId))]})]}),g&&e.jsx("div",{className:"asgn-mini",children:e.jsxs("div",{className:"asgn-miniRow",children:[e.jsx("span",{className:"asgn-miniK",children:"UserId"}),e.jsx("span",{className:"asgn-miniV asgn-mono",children:g.userId}),e.jsx("button",{className:"asgn-btn tiny ghost",onClick:()=>$(g.userId),children:"Copy"})]})})]}),e.jsxs("div",{className:"asgn-box",children:[e.jsxs("div",{className:"asgn-boxHead",children:[e.jsx("div",{className:"asgn-boxTitle",children:"GÃ¡n thiáº¿t bá»‹"}),e.jsxs("div",{className:"asgn-pill",children:[u.length," devices"]})]}),e.jsxs("div",{className:"asgn-field",children:[e.jsx("label",{className:"asgn-label",children:"Device GUID"}),e.jsx("input",{value:m,onChange:s=>f(s.target.value),placeholder:"90319774496194524687",className:"asgn-input asgn-mono"})]}),e.jsxs("div",{className:"asgn-field",children:[e.jsxs("label",{className:"asgn-label",children:["Device name ",e.jsx("span",{className:"asgn-mutedSmall",children:"(tuá»³ chá»n)"})]}),e.jsx("input",{value:S,onChange:s=>b(s.target.value),placeholder:"Kho láº¡nh A / Xe táº£i 01 ...",className:"asgn-input"})]}),e.jsxs("div",{className:"asgn-actions",children:[e.jsx("button",{className:"asgn-btn primary",disabled:!E||h,onClick:J,children:h?"Äang gÃ¡n...":"â• GÃ¡n thiáº¿t bá»‹"}),e.jsx("button",{className:"asgn-btn ghost",disabled:!a||h,onClick:()=>{f(""),b(""),r("","")},children:"LÃ m má»›i form"})]}),!a&&e.jsx("div",{className:"asgn-hint",children:"* Chá»n user trÆ°á»›c khi gÃ¡n."}),a&&e.jsx("div",{className:"asgn-hint",children:"* User chá»‰ xem Ä‘Æ°á»£c cÃ¡c device Ä‘Ã£ gÃ¡n."})]})]}),e.jsxs("div",{className:"asgn-tableWrap",children:[e.jsxs("div",{className:"asgn-tableTop",children:[e.jsx("div",{className:"asgn-boxTitle",children:"Thiáº¿t bá»‹ Ä‘Ã£ gÃ¡n"}),e.jsx("div",{className:"asgn-tableRight",children:o?e.jsx("span",{className:"asgn-chip",children:"Äang táº£i..."}):e.jsxs("span",{className:"asgn-chip",children:[u.length," thiáº¿t bá»‹"]})})]}),e.jsx("div",{className:"asgn-tableShell",children:e.jsxs("table",{className:"asgn-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"DeviceGuid"}),e.jsx("th",{children:"DeviceName"}),e.jsx("th",{style:{width:140}})]})}),e.jsxs("tbody",{children:[o&&e.jsx("tr",{children:e.jsx("td",{colSpan:3,className:"asgn-empty",children:"Äang táº£i dá»¯ liá»‡u..."})}),!o&&I.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:3,className:"asgn-empty",children:"ChÆ°a cÃ³ thiáº¿t bá»‹."})}),!o&&I.map(s=>e.jsxs("tr",{children:[e.jsx("td",{className:"asgn-mono",children:e.jsxs("div",{className:"asgn-cellGuid",children:[e.jsx("span",{children:s.deviceGuid}),e.jsx("button",{className:"asgn-btn tiny ghost",onClick:()=>$(s.deviceGuid),children:"Copy"})]})}),e.jsx("td",{children:s.deviceName||e.jsx("span",{className:"asgn-mutedSmall",children:"â€”"})}),e.jsx("td",{style:{textAlign:"right"},children:e.jsx("button",{className:"asgn-btn danger",disabled:!a||h,onClick:()=>B(s.deviceGuid),children:"âŒ Gá»¡"})})]},s.deviceGuid))]})]})}),e.jsx("div",{className:"asgn-footnote",children:"Tip: báº¡n cÃ³ thá»ƒ bá»c API unassign báº±ng quyá»n Admin, vÃ  log láº¡i ai gá»¡/gÃ¡n Ä‘á»ƒ audit."})]})]}):e.jsx("div",{className:"asgn-muted",children:e.jsx("small",{children:"Panel gÃ¡n/gá»¡ Ä‘ang áº©n. Báº¥m â€œGÃ¡n thiáº¿t bá»‹â€ Ä‘á»ƒ má»Ÿ."})})}function z(){return e.jsxs(e.Fragment,{children:[e.jsx(q,{who:"Admin"}),e.jsx("div",{style:{marginTop:12},children:e.jsx(X,{})})]})}console.log("ğŸ”¥ entry-admin loaded");const w=document.getElementById("root")||document.getElementById("react-root-admin");w?(console.log("âœ… Mounting to:",w.id),K.createRoot(w).render(e.jsx(F.StrictMode,{children:e.jsx(z,{})}))):console.error("âŒ No mount element found (#root or #react-root-admin)");
